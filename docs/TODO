1) Optimize REST-API endpoint /config/devices and /config/devices/<serial>. Complete JSON structure tends to be rebuild even after small config change.
   Have UI use this where appropiate. 

2) DONE: restapi.c, check if we can get rid of device_name_from_type(), feels misplaced here.

3) DONE: AUX configuration not working as it shares the channel id with R2.

4) Performance friendly debug output of JSON objects. That is do json_dump() only if the loglevel matches.

5) DONE: memory leak, should call tty_clode() instead of close(router->fd)

6) Check struct mh_control, set_mode, used for what? Can be removed?

7) DONE: Make submit_cmd() and derived functions as void return. Currently it returns -1 on failure, but the caller does not always check this. 
   Instead submit_cmd() should call the callbacks even when it fails, so that the caller can react to this. This way error handling has 
   to happen in one place, the callbacks.
   After some reading, even if sumit_cmd() immediately fails, the callback should be called async, that is from the main event loop. See
   ev_idle.

8) Check renamed functions in libev 4, e.g. ev_unloop() -> ev_break(). We still seem to use old ones.

9) Check signal handler in main.c.  

10) rigctld control, like start/stop with mhuxd and/or keyer becoming online / offline. rigctld could then also be used my mhuxd to track 
   the rig mode and apply it to the keyer accordingly.

11) DONE: If with new json implementation, if VSP can't be created, it gets removed from config. That is, it wouldn't be 
   saved when mhuxd terminates, since it wasn't created. We don't hold a config shadow copy anymore.

12) dmgr_set_device_added_cb(), quick hack, should manage a callback list as everyone else.

13) MK2R(+) Small UI issue, when we change baud radio on both radios, click apply for radio 1, baud rate for radio 2 
   resets to original value.

14) When staring mhuxd with no config, keyer off, then turn on keyer, it doesn't get reactively added to the keyer list.

15) Check this, when not setting high baud rate, we may get EPERM

The tcsetattr function with the TCSANOW action translates to the TCSETS ioctl call on Linux. Your con_vsp.c implementation already handles TCSETS (as well as TCSETSW for TCSADRAIN and TCSETSF for TCSAFLUSH), so the plumbing for TCSANOW is present.

The issue is that TCSETS fails with EPERM (Operation not permitted) because the requested baud rate (115200) is being rejected by termios_baud_rate().

The file linux_termios.c currently excludes baud rates of 115200 and higher unless NO_MICRO_HAM is defined. Since this macro is not defined in your build configuration, these standard high baud rates are treated as unsupported, causing the EPERM error in con_vsp.c.

I will patch linux_termios.c to enable support for these baud rates.

### core-refactor

CR-01) Define fd ownership contract in code comments and docs:
       - each fd has exactly one closer
       - non-owners can request teardown but never close directly

CR-02) Add shared endpoint state enum + helpers (`OPEN`, `DRAINING`, `FAILED`, `CLOSED`).

CR-03) Add small nonblocking I/O helpers (read/write result normalization):
       - `>0` progress
       - `==0` EOF/no-progress policy
       - `EAGAIN`/`EWOULDBLOCK` retry
       - other `<0` hard error

CR-04) Add watcher lifecycle wrappers:
       - guarded `start` (valid fd + allowed state)
       - idempotent `stop`

CR-05) Convert `con_tcp.c` to shared helpers first (no behavior change intended).

CR-06) Unify `con_tcp` teardown into one idempotent close path.

CR-07) Convert `con_vsp.c` to state-gated watcher re-arm logic and shared teardown helpers.

CR-08) Align `mhrouter.c` endpoint teardown to ownership wrappers only.

CR-09) Restrict `conmgr.c` to orchestration only (no closing router-owned fds).

CR-10) Add debug/invariant checks (gated by loglevel/debug build):
       - watcher on invalid fd
       - invalid state transition
       - close by non-owner
       - callback after terminal state

CR-11) Fault-injection validation pass:
       - forced connector read/write errors
       - repeated teardown calls
       - verify no libev invalid-fd assert

CR-12) Final cleanup:
       - remove obsolete duplicate error handling paths
       - document final architecture in `docs/core-refactor.md`
